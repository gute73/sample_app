var ChatCommon={draftKeyPrefix:"postDraft_",isManagement:!1,linkify:function(t){var e={},a="",o=/(<a[^>]*href=)(('([^']*)'|"([^"]*)"|([\S]*))[^>]*>(.*?)<\/a>)/gi,n=t;return""+(n=o.test(t)?n.replace(o,"<a target='_blank' href=$2"):n.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,function(t){if(void 0===e[t]){/\.(gif|png|jpe?g|svg)$/i.test(t)&&(a+="<br><a href='"+t+"' target='_blank' class='chat-image'><img class='st-loading-image' src='"+t+"'></a>");var o=/youtube\.com\/(?:watch\?v=|embed\/)([a-zA-Z0-9-_]+)/gi.exec(t);o&&(a+="<br><a href='"+t+"' target='_blank' class='chat-image'><i class='fa fa-youtube-square sidelogo'></i><img src='http://img.youtube.com/vi/"+o[1]+"/0.jpg'></a>");(o=/youtu\.be\/([a-zA-Z0-9-_]+)/gi.exec(t))&&(a+="<br><a href='"+t+"' target='_blank' class='chat-image'><i class='fa fa-youtube-square sidelogo'></i><img src='http://img.youtube.com/vi/"+o[1]+"/0.jpg'></a>"),e[t]=!0}return"<a href='"+t+"' target='_blank'>"+t+"</a>"}))+a},checkIsActiveAgentChatWindow:function(t){if(!ChatCommon.storageAvailable("localStorage"))return!(!$(".chatControl[data-id='{0}']".format(t)).length||!document.hasFocus&&!top.document.hasFocus);var e=localStorage.getItem("agentChat_"+t+"_active");return!(void 0===e||!e||-1===e.indexOf("{"+self.window.name+"}"))},checkIsActiveClientChatWindow:function(t){if(!ChatCommon.storageAvailable("localStorage"))return!(!$(".chatControl[data-id='{0}']".format(t)).length||!document.hasFocus&&!top.document.hasFocus);var e=localStorage.getItem("liveChat_"+t+"_active");return!(void 0===e||!e||-1===e.indexOf("{"+self.window.name+"}"))},checkIfAnyActiveAgentChatIsFocused:function(t){if(!ChatCommon.storageAvailable("localStorage"))return!1;var e=localStorage.getItem("chat-focused"),a=localStorage.getItem("agentChat_"+t+"_active");return!(void 0===e||!e||void 0===a||!a)&&-1!==a.indexOf(e)},checkIfAnyActiveAgentChatWindows:function(t){if(!ChatCommon.storageAvailable("localStorage"))return!(!$(".chatControl[data-id='{0}']".format(t)).length||!document.hasFocus&&!top.document.hasFocus);var e=localStorage.getItem("agentChat_"+t+"_active");return!(void 0===e||!e)},checkIfAnyActiveClientChatIsFocused:function(t){if(!ChatCommon.storageAvailable("localStorage"))return!1;var e=localStorage.getItem("chat-focused"),a=localStorage.getItem("liveChat_"+t+"_active");return!(void 0===e||!e||void 0===a||!a)&&-1!==a.indexOf(e)},checkIfAnyActiveClientChatWindows:function(t){if(!ChatCommon.storageAvailable("localStorage"))return!(!$(".chatControl[data-id='{0}']".format(t)).length||!document.hasFocus&&!top.document.hasFocus);var e=localStorage.getItem("liveChat_"+t+"_active");return!(void 0===e||!e)},deleteDraft:function(t,e){if(window.sessionStorage&&t){var a=ChatCommon.draftKeyPrefix+t+"_"+e;a in sessionStorage&&sessionStorage.removeItem(a)}},getDraft:function(t,e){if(!window.sessionStorage)return null;var a=ChatCommon.draftKeyPrefix+t+"_"+e;if(!(a in sessionStorage))return null;var o=sessionStorage.getItem(a);if(!o)return null;var n=new PostDraft;return n.parseFromString(o),n},saveDraft:function(t,e,a,o){if(window.sessionStorage&&t&&e){var n=$(e).val();if(n){var r=new PostDraft(t,n,!!a,!!o),i=ChatCommon.draftKeyPrefix+t+"_"+!!o;sessionStorage.setItem(i,r.toString())}else this.deleteDraft(t,!!o)}},popupNewIMDataCallBack:function(t){window.open(t.virtualPath+"Management/Chat/frmAgentChat.aspx?mode=im&key="+encodeURIComponent(t.key),"AgentChat_"+t.key,"width=600,height=500,resizable=yes,scrollbars=yes,status=yes")},newIMDataCallBack:function(t){var e=$(".chatCard[data-room='{0}']".format(t.key));e.length&&st_chatCard_onClick(e)}};"function"==typeof _&&(ChatCommon.saveDraftThrottled=_.throttle(ChatCommon.saveDraft,5e3)),ChatCommon.storageAvailable=function(t){var e;try{e=window[t];var a="__storage_test__";return e.setItem(a,a),e.removeItem(a),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}},ChatCommon.focusing=function(){function t(){ChatCommon.storageAvailable("localStorage")&&$(".chatControl").length&&localStorage.setItem("chat-focused","{"+self.window.name+"}")}function e(){ChatCommon.storageAvailable("localStorage")&&(localStorage.getItem("chat-focused")||"")==="{"+self.window.name+"}"&&localStorage.removeItem("chat-focused")}document.hasFocus()&&t(),$(window).on("blur",function(){e()}),$(window).on("focus",function(){t()}),$(window).on("unload",function(){e()})},PostDraft=function(t,e,a,o){this.chatKey=t,this.content=e,this.hasCannedReply=a,this.isCoaching=o},PostDraft.prototype.toString=function(){return this.chatKey+"|=|"+this.content+"|=|"+this.hasCannedReply+"|=|"+this.isCoaching},PostDraft.prototype.parseFromString=function(t){var e=t.split("|=|");this.chatKey=e[0],this.content=e[1],this.hasCannedReply="true"===e[2].toLowerCase(),this.isCoaching="true"===e[3].toLowerCase()},$(function(){$.QueryString=function(t){for(var e={},a=0;a<t.length;++a){var o=t[a].split("=",2);2===o.length&&(e[o[0]]=decodeURIComponent(o[1].replace(/\+/g," ")))}return e}(window.location.search.substr(1).split("&"))});
//# sourceMappingURL=ChatCommon.js.map
